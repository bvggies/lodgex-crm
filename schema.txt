
-- Users Table (Handles Staff, Admins, Managers, Owners)
CREATE TABLE IF NOT EXISTS users (
    id VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    phone VARCHAR(50),
    role VARCHAR(50) NOT NULL, -- 'Admin', 'Manager', 'Cleaner', 'Maintenance', 'Owner'
    status VARCHAR(50) DEFAULT 'Active',
    avatar_url TEXT,
    joined_date DATE DEFAULT CURRENT_DATE,
    properties_count INTEGER DEFAULT 0, -- Mostly for owners
    documents JSONB DEFAULT '[]'::JSONB, -- Stores staff documents
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Properties Table
CREATE TABLE IF NOT EXISTS properties (
    id VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    code VARCHAR(50) NOT NULL,
    address TEXT NOT NULL,
    status VARCHAR(50) DEFAULT 'Active',
    unit_type VARCHAR(50),
    owner_id VARCHAR(255),
    price_per_night DECIMAL(10, 2),
    amenities JSONB DEFAULT '[]'::JSONB,
    description TEXT,
    image_url TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Guests Table
CREATE TABLE IF NOT EXISTS guests (
    id VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    phone VARCHAR(50),
    total_stays INTEGER DEFAULT 0,
    total_spent DECIMAL(10, 2) DEFAULT 0,
    last_stay DATE,
    rating INTEGER DEFAULT 5,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Bookings Table
CREATE TABLE IF NOT EXISTS bookings (
    id VARCHAR(255) PRIMARY KEY,
    reference VARCHAR(50) NOT NULL,
    guest_id VARCHAR(255),
    guest_name VARCHAR(255), -- Denormalized for easier display
    property_id VARCHAR(255),
    property_name VARCHAR(255), -- Denormalized
    check_in DATE NOT NULL,
    check_out DATE NOT NULL,
    status VARCHAR(50) NOT NULL, -- 'Confirmed', 'Pending', 'Cancelled', etc.
    payment_status VARCHAR(50) DEFAULT 'Pending',
    total_amount DECIMAL(10, 2),
    channel VARCHAR(50) DEFAULT 'Direct',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tasks Table
CREATE TABLE IF NOT EXISTS tasks (
    id VARCHAR(255) PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    type VARCHAR(50), -- 'Cleaning', 'Maintenance'
    priority VARCHAR(20), -- 'Low', 'Medium', 'High'
    status VARCHAR(50) DEFAULT 'Open',
    property_id VARCHAR(255),
    due_date DATE,
    assignee_id VARCHAR(255),
    approval_status VARCHAR(50) DEFAULT 'Approved', -- 'Pending', 'Approved', 'Rejected'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Finance Table
CREATE TABLE IF NOT EXISTS finance (
    id VARCHAR(255) PRIMARY KEY,
    date DATE NOT NULL,
    description TEXT NOT NULL,
    amount DECIMAL(10, 2) NOT NULL,
    type VARCHAR(20) NOT NULL, -- 'Revenue', 'Expense'
    category VARCHAR(100),
    reference_id VARCHAR(255), -- Link to Booking ID or Task ID
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Audit Logs
CREATE TABLE IF NOT EXISTS audit_logs (
    id VARCHAR(255) PRIMARY KEY,
    user_name VARCHAR(255),
    action VARCHAR(50), -- 'CREATE', 'UPDATE', 'DELETE', 'LOGIN'
    entity VARCHAR(50),
    details TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Indexes for better performance
CREATE INDEX IF NOT EXISTS idx_bookings_property_id ON bookings(property_id);
CREATE INDEX IF NOT EXISTS idx_bookings_check_in ON bookings(check_in);
CREATE INDEX IF NOT EXISTS idx_tasks_assignee_id ON tasks(assignee_id);
CREATE INDEX IF NOT EXISTS idx_tasks_status ON tasks(status);
CREATE INDEX IF NOT EXISTS idx_properties_owner_id ON properties(owner_id);
